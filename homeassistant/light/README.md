# Light Control Application

Полнофункциональное Django приложение для управления умным освещением с поддержкой Yeelight устройств.

## Возможности

### 🏠 Управление устройствами
- Включение/выключение света
- Регулировка яркости (1-100%)
- Изменение цветовой температуры (1700K-6500K)
- Установка RGB цветов
- Управление через веб-интерфейс и API

### 👥 Группы освещения
- Создание групп устройств
- Массовое управление группами
- Организация по комнатам

### ⏰ Расписания
- Автоматическое включение/выключение по времени
- Настройка дней недели
- Установка яркости для включения

### 🎨 Веб-интерфейс
- Современный темный дизайн
- Адаптивный интерфейс для планшетов
- Интуитивное управление слайдерами
- Цветовые пикеры и предустановки

## Структура приложения

```
homeassistant/light/
├── models.py              # Модели данных
├── views.py               # Представления Django
├── urls.py                # URL маршруты
├── admin.py               # Админ панель
├── apps.py                # Конфигурация приложения
├── light_controller.py    # Контроллер устройств
├── tests.py               # Тесты
└── templates/light/       # HTML шаблоны
    ├── base.html
    ├── dashboard.html
    ├── device_list.html
    ├── device_detail.html
    ├── group_list.html
    └── schedule_list.html
```

## Модели данных

### LightDevice
- Информация об устройстве (название, IP, тип)
- Настройки подключения
- Статус активности

### LightState
- Текущее состояние устройства
- Яркость, цветовая температура, RGB цвет
- Автоматическое обновление при изменениях

### LightGroup
- Группировка устройств
- Массовые операции
- Организация по комнатам

### LightSchedule
- Расписания автоматизации
- Время выполнения и дни недели
- Действия для устройств или групп

## API Endpoints

### Управление устройствами
- `POST /light/api/device/{id}/toggle/` - Переключение состояния
- `POST /light/api/device/{id}/brightness/` - Установка яркости
- `POST /light/api/device/{id}/temperature/` - Установка температуры
- `POST /light/api/device/{id}/rgb/` - Установка RGB цвета
- `GET /light/api/device/{id}/status/` - Получение состояния

### Управление группами
- `POST /light/api/group/{id}/control/` - Управление группой

### Статус
- `GET /light/api/devices/status/` - Состояние всех устройств

## Установка и настройка

1. Приложение уже добавлено в `INSTALLED_APPS`
2. URL маршруты настроены в главном `urls.py`
3. Миграции созданы и применены

### Добавление устройств

Через Django Admin:
1. Перейдите в `/admin/light/lightdevice/add/`
2. Укажите название устройства
3. Введите IP адрес устройства Yeelight
4. Выберите комнату (опционально)

### Использование

1. **Главная панель**: `/light/` - основной интерфейс управления
2. **Устройства**: `/light/devices/` - список всех устройств
3. **Подробности**: `/light/devices/{id}/` - детальное управление
4. **Группы**: `/light/groups/` - управление группами
5. **Расписания**: `/light/schedules/` - настройка автоматизации

## Возможности контроллера

### LightController
- Автоматическое подключение к устройствам
- Кэширование соединений
- Обработка ошибок
- Синхронизация с базой данных

### Методы управления
- `turn_on()` / `turn_off()` - включение/выключение
- `set_brightness()` - яркость
- `set_color_temp()` - цветовая температура
- `set_rgb()` - RGB цвет
- `toggle()` - переключение состояния
- `get_properties()` - получение свойств устройства

## Поддерживаемые устройства

- **Yeelight** - основная поддержка
- **Philips Hue** - заготовка для будущей поддержки
- **Generic Smart Light** - универсальные устройства

## Безопасность

- CSRF защита для API
- Валидация входных данных
- Обработка ошибок сети
- Логирование операций

## Тестирование

Запуск тестов:
```bash
poetry run python manage.py test homeassistant.light
```

Покрывает:
- Модели данных
- Веб-интерфейс
- API endpoints
- Валидацию данных

## Интеграция с основным приложением

Кнопка "Свет" на главной панели теперь может быть связана с:
```javascript
window.location.href = '/light/'
```

Или через API:
```javascript
fetch('/light/api/devices/status/')
  .then(response => response.json())
  .then(data => console.log(data.devices));
```